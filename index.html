<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TapMoney</title>
    <!-- Google Fonts - 'Bangers' for a cartoony/gamey feel -->
    <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
    <!-- Tailwind CSS import -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Fallback font */
            background-color: #1a202c; /* Solid dark background */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Space out header, content, footer */
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0; /* Remove body padding, elements within will have their own spacing */
            box-sizing: border-box;
            color: #e2e8f0; /* Light text */
            overflow: hidden; /* Prevent scrolling if elements slightly overflow */
            position: relative; /* For absolute positioning of navbar */
        }
        /* Apply 'Bangers' font to game-specific elements */
        .game-font {
            font-family: 'Bangers', cursive;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); /* Add some shadow for readability */
        }

        .score-text {
            font-size: 2.2rem; /* Further reduced font size for score */
            font-weight: normal; /* Bangers is already bold, no need for extra bold */
            color: #68d391; /* Green for score */
            margin-bottom: 20px; /* Space below score */
            text-align: center;
            width: 100%;
            padding-top: 20px; /* Padding from top of screen */
        }
        .click-button {
            background-color: #3b82f6; /* Blue button */
            color: white;
            width: 180px; /* Slightly smaller fixed width for round shape */
            height: 180px; /* Slightly smaller fixed height for round shape */
            border-radius: 50%; /* Make it perfectly round */
            font-size: 1.3rem; /* Text size for button */
            display: flex; /* Flexbox for centering content inside */
            justify-content: center;
            align-items: center;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4); /* Stronger shadow for floating effect */
            position: relative;
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        .click-button:hover:not(:disabled) {
            background-color: #2563eb; /* Darker on hover */
            transform: scale(1.05); /* Slight enlarge on hover */
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.5); /* Stronger shadow on hover */
        }
        .click-button:active:not(:disabled) {
            transform: scale(0.98); /* Slight shrink on click */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Smaller shadow on click */
        }
        .click-button:disabled {
            background-color: #4a5568; /* Gray for disabled button */
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .timer-text {
            font-size: 1.2rem; /* Smaller timer text */
            color: #f6ad55; /* Orange for timer */
            margin-top: 20px; /* Space below button */
            text-align: center;
            width: 100%;
        }
        .loading-text {
            font-size: 1rem; /* Smaller loading text */
            color: #a0aec0;
            margin-top: 10px;
            text-align: center;
            width: 100%;
        }

        /* Main content area to center the button and score vertically */
        #gameScreen { /* Adjusted to be the main flex container for score, button, timer, loading */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center content vertically */
            align-items: center;
            flex-grow: 1; /* Allows it to take up available vertical space */
            width: 100%;
            padding-bottom: 70px; /* Space for the fixed navbar */
            box-sizing: border-box;
        }

        /* Navbar styles */
        .navbar {
            display: flex;
            justify-content: space-around; /* Distribute items evenly with space around them */
            align-items: center;
            width: 100%;
            background-color: #2d3748; /* Darker background for navbar */
            padding: 8px 0; /* Reduced padding */
            position: fixed; /* Fix at the bottom */
            bottom: 0;
            left: 0;
            z-index: 100; /* Ensure it's on top */
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3); /* Shadow on top */
        }
        .nav-button {
            background-color: transparent;
            border: none;
            color: #cbd5e0;
            font-size: 0.75rem; /* Smaller font size for button text */
            padding: 6px 5px; /* Reduced padding */
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px; /* Reduced gap between icon and text */
            flex: 1; /* Allow buttons to grow and shrink to fit, ensuring equal width */
            min-width: 0; /* Allow shrinking below content if needed */
            text-align: center;
            white-space: nowrap; /* Prevent text wrapping */
        }
        .nav-button:hover {
            background-color: #4a5568;
            color: white;
        }
        .nav-button.active {
            background-color: #3b82f6; /* Highlight active button */
            color: white;
        }
        .nav-button-icon {
            font-size: 1.2rem; /* Smaller icon size */
        }
    </style>
    <!-- Monetag Ad Block Code (Interstitial) -->
    <script src='//libtl.com/sdk.js' data-zone='9473169' data-sdk='show_9473169'></script>
</head>
<body>
    <!-- Game Screen -->
    <div id="gameScreen">
        <p class="score-text game-font">TapCoins: <span id="score">0</span></p>
        <button id="clickButton" class="click-button" disabled>–ó–∞–≥—Ä—É–∑–∫–∞...</button>
        <p id="timerDisplay" class="timer-text hidden"></p>
        <p id="loadingText" class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
    </div>

    <!-- Navigation Bar -->
    <div class="navbar">
        <button class="nav-button active" onclick="openTelegramWebApp('main')">
            <span class="nav-button-icon">üè†</span> <!-- Home icon -->
            –ì–ª–∞–≤–Ω–∞—è
        </button>
        <button class="nav-button" onclick="openTelegramWebApp('shop')">
            <span class="nav-button-icon">üõí</span> <!-- Shop icon -->
            –ú–∞–≥–∞–∑–∏–Ω
        </button>
        <button class="nav-button" onclick="openTelegramWebApp('tasks')">
            <span class="nav-button-icon">‚úÖ</span> <!-- Tasks icon -->
            –ó–∞–¥–∞–Ω–∏—è
        </button>
        <button class="nav-button" onclick="openTelegramWebApp('friends')">
            <span class="nav-button-icon">ü§ù</span> <!-- Friends icon -->
            –î—Ä—É–∑—å—è
        </button>
        <button class="nav-button" onclick="openTelegramWebApp('stats')">
            <span class="nav-button-icon">üìä</span> <!-- Stats icon -->
            –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </button>
        <button class="nav-button" onclick="openTelegramWebApp('settings')">
            <span class="nav-button-icon">‚öôÔ∏è</span> <!-- Settings icon -->
            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </button>
    </div>

    <script>
        const scoreDisplay = document.getElementById('score');
        const clickButton = document.getElementById('clickButton');
        const timerDisplay = document.getElementById('timerDisplay');
        const loadingText = document.getElementById('loadingText');

        let score = 0;
        const adTimerDuration = 15; // Timer duration in seconds (15 or 30)
        const localStorageScoreKey = 'tapCoinsScore'; // Key for score in localStorage

        // Telegram Web App object
        const TelegramWebApp = window.Telegram && window.Telegram.WebApp;

        // Function to open a new Telegram Web App page
        function openTelegramWebApp(page) {
            let url = 'https://tanya1232.github.io/TapMoney/index.html'; // Default to index.html for all for now
            // In the future, you would map 'shop' to 'shop.html', 'tasks' to 'tasks.html', etc.
            // Example: if (page === 'shop') url = 'https://tanya1232.github.io/TapMoney/shop.html';

            if (TelegramWebApp) {
                console.log(`Opening WebApp page: ${page} with URL: ${url}`);
                TelegramWebApp.openLink(url);
            } else {
                console.warn(`Telegram WebApp not found. Cannot open page: ${page}. Attempting direct browser open.`);
                window.open(url, '_blank'); // Fallback for testing outside Telegram
            }

            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            // Add active class to the clicked button (simplistic, won't persist across actual page reloads/navigations)
            // event.currentTarget is null if called without event, so check
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
        }
        window.openTelegramWebApp = openTelegramWebApp; // Make global for onclick

        // Function to load TapCoins from localStorage
        function loadTapCoins() {
            loadingText.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ TapCoins...";
            clickButton.disabled = true; // Disable button while loading

            try {
                const savedScore = localStorage.getItem(localStorageScoreKey);
                if (savedScore !== null) {
                    score = parseInt(savedScore, 10); // Convert string to integer
                    if (isNaN(score)) { // Handle case where savedScore is not a valid number
                        score = 0;
                        console.warn("Invalid score in localStorage, resetting to 0.");
                    }
                    console.log("TapCoins loaded from localStorage:", score);
                } else {
                    score = 0;
                    console.log("No existing TapCoins in localStorage, starting from 0.");
                }
                scoreDisplay.textContent = score;
                loadingText.textContent = ""; // Clear loading message
                clickButton.disabled = false; // Enable button
                clickButton.textContent = '–ü–æ–ª—É—á–∏—Ç—å TapCoins';
            } catch (error) {
                console.error("Error loading TapCoins from localStorage:", error);
                loadingText.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ TapCoins. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏–≥—Ä—É.";
                clickButton.disabled = true;
            }
        }

        // Function to save TapCoins to localStorage
        function saveTapCoins() {
            try {
                localStorage.setItem(localStorageScoreKey, score.toString()); // Save as string
                console.log("TapCoins saved to localStorage:", score);
            } catch (error) {
                console.error("Error saving TapCoins to localStorage:", error);
            }
        }

        // Function to call the Monetag ad block
        function showMonetagAd() {
            if (typeof show_9473169 === 'function') {
                console.log("Calling Monetag ad...");
                show_9473169();
            } else {
                console.warn("Function show_9473169() not found. Monetag SDK might not have loaded yet or the zone is configured differently.");
                // Fallback: if ad doesn't show, continue as normal
            }
        }

        // Click event handler for the main game button
        clickButton.addEventListener('click', () => {
            clickButton.disabled = true;
            clickButton.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–ª–∞–º—ã...';
            timerDisplay.classList.add('hidden');

            showMonetagAd();

            let timeLeft = adTimerDuration;
            timerDisplay.textContent = `–î–æ –Ω–∞–≥—Ä–∞–¥—ã: ${timeLeft} —Å–µ–∫`;
            timerDisplay.classList.remove('hidden');

            const timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = `–î–æ –Ω–∞–≥—Ä–∞–¥—ã: ${timeLeft} —Å–µ–∫`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    score++;
                    scoreDisplay.textContent = score;
                    clickButton.textContent = '–ü–æ–ª—É—á–∏—Ç—å TapCoins';
                    clickButton.disabled = false;
                    timerDisplay.classList.add('hidden');
                    console.log('Score increased, button active. Saving...');
                    saveTapCoins(); // Save score immediately after getting a TapCoin
                }
            }, 1000);
        });

        // Initial load of TapCoins when the page loads
        document.addEventListener('DOMContentLoaded', loadTapCoins);

        // Save score when the app is closed or hidden
        window.addEventListener('beforeunload', saveTapCoins);
        window.addEventListener('pagehide', saveTapCoins);
    </script>
</body>
</html>
